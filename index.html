<!DOCTYPE html>
<html>
<head>
  <title>Free Route & Mileage</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 500px; margin-top: 20px; }
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 8px; margin-top: 5px; width: 100%; }
    button { background: black; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Route & Mileage (OpenRouteService)</h2>
  <form id="routeForm">
    <label>Start (City, ST):</label>
    <input type="text" id="start" value="Catoosa, OK" required>
    <label>End (City, ST):</label>
    <input type="text" id="end" value="Bowie, TX" required>
    <button type="submit">Get Route</button>
  </form>

  <p id="distance"></p>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([39, -98], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18
    }).addTo(map);

    const apiKey = "your-api-key-here"; // Replace with your actual OpenRouteService key
    let routeLayer;

    async function geocodeNominatim(place) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}`;
      const res = await fetch(url);
      const data = await res.json();
      if (!data.length) throw new Error(`Location not found: ${place}`);
      return [parseFloat(data[0].lon), parseFloat(data[0].lat)];
    }

    document.getElementById("routeForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;

      try {
        const [startCoords, endCoords] = await Promise.all([
          geocodeNominatim(start),
          geocodeNominatim(end)
        ]);

        const body = {
          coordinates: [startCoords, endCoords]
        };

        const routeResp = await fetch('https://api.openrouteservice.org/v2/directions/driving-car/geojson', {
          method: 'POST',
          headers: {
            'Authorization': apiKey,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        if (!routeResp.ok) throw new Error("Failed to fetch route");

        const routeData = await routeResp.json();
        const distance = routeData.features[0].properties.summary.distance / 1609.34;
        document.getElementById('distance').innerText = `Distance: ${distance.toFixed(2)} miles`;

        if (routeLayer) {
          map.removeLayer(routeLayer);
        }

        routeLayer = L.geoJSON(routeData).addTo(map);
        map.fitBounds([
          [startCoords[1], startCoords[0]],
          [endCoords[1], endCoords[0]]
        ]);

      } catch (err) {
        alert("Error: " + err.message);
        console.error(err);
      }
    });
  </script>
</body>
</html>
